<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Generic-TCG test</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta http-equiv="pragma" content="no-cache"/>
    <meta http-equiv="Cache-Control" content="no-cache"/>
    <meta http-equiv="Expires" content="-1">

    <style type="text/css">
        body {
            font-size: 12px;
            background-color: #000000;
        }

        #mainCardContainer {
            background-color: #1f1f1f;
        }

        .card {
            position: absolute;
            background-color: #efefef;
        }

        .cardImg {
            width: 100%;
            height: 100%;
            background-color: #000000;
        }
    </style>
    <link rel="stylesheet" type="text/css" href="css/dark-hive/jquery-ui-1.8.16.custom.css">

    <script type="text/javascript" src="js/jquery/jquery-1.6.2.js"></script>
    <script type="text/javascript" src="js/jquery/jquery-ui-1.8.16.custom.min.js"></script>
    <script type="text/javascript" src="js/jquery/jquery-sizes.js"></script>

    <script type="text/javascript" src="js/common.js"></script>
    <script type="text/javascript" src="js/inheritance.js"></script>

    <script type="text/javascript" src="js/CardContainer.js"></script>
    <script type="text/javascript" src="js/CardGroup.js"></script>

    <script type="text/javascript" src="js/SampleGameUi.js"></script>

    <script type="text/javascript" src="js/RowCardLayoutCardGroup.js"></script>
    <script type="text/javascript" src="js/AttachedCardsLayoutCardGroup.js"></script>

    <script type="text/javascript">
        var gameUi1;
        var gameUi2;
        var gameUi3;

        $(document).ready(
                function () {
                    $("#tabs").tabs();

                    var firstLayoutCardContainer = $("#tabs-1");
                    var firstGroup = new RowCardLayoutCardGroup(firstLayoutCardContainer,
                            function(cardDiv, cardId, props) {
                                return true;
                            });

                    gameUi1 = new SampleGameUi(firstLayoutCardContainer, firstGroup);

                    var secondLayoutCardContainer = $("#tabs-2");
                    var secondGroup = new AttachedCardsLayoutCardGroup(secondLayoutCardContainer,
                            function(cardDiv, cardId, props) {
                                return props["attach1"]==null;
                            });

                    var cardAttachedToSecondGroup = function(cardId, rootCardId) {
                        var cardProps = secondGroup.findCardPropsById(cardId);
                        var attachedTo = cardProps["attach1"];
                        if (attachedTo != null) {
                            if (attachedTo == rootCardId)
                                return true;
                            else
                                return cardAttachedToSecondGroup(attachedTo, rootCardId);
                        }
                        return false;
                    };

                    secondGroup.setZIndexBase(100);
                    secondGroup.addAttachedGroup(-1/3, 0,
                            function(cardDiv, cardId, props) {
                                return props["attach1"]==null;
                            },
                            function(cardDiv, cardId, props, cardDivAtt, cardIdAtt, propsAtt) {
                                return cardAttachedToSecondGroup(cardIdAtt, cardId);
                            });

                    gameUi2 = new SampleGameUi(secondLayoutCardContainer, secondGroup);

                    var thirdLayoutCardContainer = $("#tabs-3");
                    var thirdGroup = new AttachedCardsLayoutCardGroup(thirdLayoutCardContainer,
                            function(cardDiv, cardId, props) {
                                return props["attach1"]==null;
                            });

                    var cardAttachedToThirdGroup = function(cardId, rootCardId) {
                        var cardProps = thirdGroup.findCardPropsById(cardId);
                        var attachedTo = cardProps["attach1"];
                        if (attachedTo != null) {
                            if (attachedTo == rootCardId)
                                return true;
                            else
                                return cardAttachedToThirdGroup(attachedTo, rootCardId);
                        }
                        return false;
                    };

                    thirdGroup.setZIndexBase(100);
                    thirdGroup.addAttachedGroup(1/7, 0,
                            function(cardDiv, cardId, props) {
                                return props["attach1"]==null;
                            },
                            function(cardDiv, cardId, props, cardDivAtt, cardIdAtt, propsAtt) {
                                return cardAttachedToThirdGroup(cardIdAtt, cardId);
                            });

                    gameUi3 = new SampleGameUi(thirdLayoutCardContainer, thirdGroup);

                    $(window).resize(
                            function() {
                                resize();
                            });

                    resize();

                    gameUi1.addCard("1", {});
                    gameUi1.addCard("2", {});
                    gameUi1.addCard("3", {});
                    gameUi1.addCard("4", {});
                    gameUi1.addCard("5", {"hor":true});

                    gameUi2.addCard("3", {});
                    gameUi2.addCard("4", {"attach1": "3", "hor": true});
                    gameUi2.addCard("5", {"hor":true});
                    gameUi2.addCard("6", {"attach1": "4", "hor": true});
                    gameUi2.addCard("7", {"attach1": "6"});

                    gameUi3.addCard("3", {});
                    gameUi3.addCard("4", {"attach1": "3", "hor": true});
                    gameUi3.addCard("5", {"hor":true});
                    gameUi3.addCard("6", {"attach1": "4", "hor": true});
                    gameUi3.addCard("7", {"attach1": "6"});

                    gameUi1.layoutCards();
                    gameUi2.layoutCards();
                    gameUi3.layoutCards();
                });

        function resize() {
            var width = $(window).width();
            var height = $(window).height();

            var border = $("#tabs").border();

            width = width - border.left - border.right;
            height = height - border.top - border.bottom;

            var innerWidth = width - 30;
            var innerHeight = height - 30;

            if (innerHeight < 300)
                innerHeight = 300;
            if (innerWidth < 400)
                innerWidth = 400;

            $("#tabs").css({"width": innerWidth, "height": innerHeight});

            var resultHeight = innerHeight-$("ul", $("#tabs")).height();
            resultHeight = resultHeight - 3;
            
            gameUi1.layoutGame(innerWidth, resultHeight);
            gameUi2.layoutGame(innerWidth, resultHeight);
            gameUi3.layoutGame(innerWidth, resultHeight);
        }

    </script>
</head>
<body>
<div id="tabs">
    <ul>
        <li><a href="#tabs-1">First layout</a></li>
        <li><a href="#tabs-2">Second layout</a></li>
        <li><a href="#tabs-3">Third layout</a></li>
    </ul>
    <div id="tabs-1" style="position: relative"></div>
    <div id="tabs-2" style="position: relative"></div>
    <div id="tabs-3" style="position: relative"></div>
</div>
</body>
</html>
